#!/usr/bin/env bash

set -e

. ${0%/*}/../../include/subr.sh

InstallRootAutorizedKey(){
	UserRequireRoot "InstallRootAutorizedKey"

	local KEY="$1"

	[ -z "$KEY" ] && echo "InstallRootAutorizedKey: key is required!" && exit 2

	local HOME="/root"
	local KEYS="$HOME/.ssh/authorized_keys"
	
	mkdir -p "$HOME/.ssh"
	touch "$KEYS"
	
	InternReplaceLine "$KEYS" "$KEY" "$KEY"
	
	chown root:wheel "$KEYS"
	chmod 600 "$KEYS"
}

case "$0" in
	*/myx.common/bin/lib/installRootAutorizedKey) 
		InstallRootAutorizedKey $@
	;;
esac
