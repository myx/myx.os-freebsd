#!/bin/sh

set -e

. /usr/local/share/myx.common/include/subr-freebsd.sh
UserRequireRoot


# Postfix installation
BATCH="YES" POSTFIX_DEFAULT_MTA="YES" pkg install -y postfix
sysrc -f /etc/rc.conf \
	sendmail_enable="NO" \
	sendmail_submit_enable="NO" \
	sendmail_msp_queue_enable="NO" \
	postfix_enable="YES"
sysrc -f /etc/periodic.conf \
	daily_clean_hoststat_enable="NO" \
	daily_status_mail_rejects_enable="NO" \
	daily_status_include_submit_mailq="NO" \
	daily_submit_queuerun="NO"
myx.common lib/replaceLine /usr/local/etc/postfix/main.cf 'inet_interfaces = all' 'inet_interfaces = loopback-only'
newaliases
service sendmail stop > /dev/null || echo "sendmail is not running (which is good)"
postconf compatibility_level=2 || true
service postfix restart
