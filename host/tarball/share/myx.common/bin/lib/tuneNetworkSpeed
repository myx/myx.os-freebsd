#!/bin/sh

set -e

type UserRequireRoot >/dev/null 2>&1 || \
	. "/usr/local/share/myx.common/bin/user/requireRoot"

UserRequireRoot

type SetSysctlConf >/dev/null 2>&1 || \
	. "/usr/local/share/myx.common/bin/lib/setSysctlConf"


SetSysctlConf kern.ipc.soacceptqueue --grow 2048
SetSysctlConf kern.ipc.somaxconn --grow 1024
SetSysctlConf net.inet.tcp.msl --shrink 10000
SetSysctlConf kern.maxfiles --grow 999999
SetSysctlConf kern.ipc.maxsockets --grow 888888

SetSysctlConf net.inet.tcp.nolocaltimewait 1
SetSysctlConf net.inet.tcp.maxtcptw 16384
SetSysctlConf net.inet.tcp.msl --shrink 8000

SetSysctlConf net.inet.ip.portrange.first --shrink 1024
SetSysctlConf net.inet.ip.portrange.last --grow 65535
SetSysctlConf net.inet.tcp.fast_finwait2_recycle 1
SetSysctlConf net.inet.tcp.finwait2_timeout --shrink 3000

SetSysctlConf net.bpf.optimize_writers 1

SetSysctlConf net.inet.tcp.blackhole 2
SetSysctlConf net.inet.udp.blackhole 1
SetSysctlConf net.inet.ip.redirect 0
