#!/bin/sh

set -e

PARAM="$1"

if [ "$2" == "--grow" ] ; then
	GROW="TRUE"
	shift
fi

VALUE="$2"

if sysctl -n "$PARAM" > /dev/null 2>&1 ; then

	CURRENT="$(sysctl -n "$PARAM")"

	if [ "$GROW" = "TRUE" ] ; then
		if [ "$VALUE" -gt "$CURRENT" ] ; then 
			sysctl "$PARAM=$VALUE" && myx.common lib/replaceLine /etc/sysctl.conf "^$PARAM=*" "$PARAM=$VALUE" || true
		fi
	else
		if [ "$VALUE" = "$CURRENT" ] ; then 
			sysctl "$PARAM=$VALUE" && myx.common lib/replaceLine /etc/sysctl.conf "^$PARAM=*" "$PARAM=$VALUE" || true
		fi
	fi

else

	echo "sysctl oid $PARAM in not supported!" >&2

fi
